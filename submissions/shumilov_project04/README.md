# Project #04
- Author: Kirill Shumilov
- Date: 03/21/2025

# Requirements
```requirements
C++ Compiler: GCC/Clang supporing C++23 standard
CMake >=3.24
MPI Library
```

# File Tree
```
shumilov_project04
├── CMakeLists.txt
├── README.md
├── analysis
│   ├── Analysis-1.pdf
│   ├── analysis.ipynb
│   ├── tests
│   │   ├── data.csv
│   │   ├── ...
│   │   ├── g8_lup.inp
│   │   └── g8_pj.inp
│   └── utils
│       └── ...
├── compile_project04.sh
├── examples
│   ├── Flux
│   ├── s12_pj.inp
│   ├── s12_pj.out
│   └── s8_pj.inp
├── include
│   ├── CMakeLists.txt
│   ├── methods
│   │   ├── array.h
│   │   ├── finite_difference.h
│   │   ├── linalg
│   │   │   ├── Axb
│   │   │   │   ├── algorithm.h
│   │   │   │   └── ...
│   │   │   └── ...
│   │   ├── optimize.h
│   │   ├── special.h
│   │   ├── stencil.h
│   │   └── utils
│   │       ├── grid.h
│   │       ├── io.h
│   │       └── math.h
│   └── project
│       └── space.h
├── lab_include
│   ├── inputs.h
│   ├── mpi_utils.h
│   ├── parallel_fd.h
│   └── topology.h
├── src
│   ├── mpi_utils.cpp
│   └── project.cpp
├── submit_project04.n16.sh
├── submit_project04.n4.sh
├── submit_project04.n64.sh
└── submit_project04.sh
```


# Hazel HPC System (NCSU)
The code has been run and tested on Hazel. Before continuing login in on the login node of the cluster:
```bash
ssh -X $USER:login.hpc.ncsu.edu
```
Load the latest GCC compiler, CMake, and MPI Implementation:
```bash
module purge
module load cmake/3.24
module load gcc/13.2.0
module load mpi/mpich-x86_64
```

## 1. Initialize the build directory
```bash
cmake -S. -Bbuild -DCMAKE_BUILD_TYPE=Release --fresh
```

## 2. Compile
Please, make sure to compile all the code on the login node, **before** running it on the compute node.
### Compile MPI Parallel Code
The main parallel MPI utility can be compiled using:
```bash
cmake --build build --config Release --target project04 -- -j
```

### Compile with single command
```bash
[kshumil@login02 shumilov_project04]$ ./compile_project04.sh
```

At this point the executable can be found in:
```
================================================================================
NE 591 Project #04
Author: Kirill Shumilov
Date: 03/21/2025
--------------------------------------------------------------------------------
Solving Source Iteration Equations with Parallel Point-Jacobi
================================================================================
Usage: shumilov_project03 [--help] input

Positional arguments:
  input       Path to input file. 

Optional arguments:
  -h, --help  shows help message and exits
```
The code primarily outputs to stdout. To capture the output to the file use `>` operator:

## Examples
### Running serially for small system
```
[kshumil@login02 shumilov_project04]$ ./shumilov_project04 examples/s8_pj.inp 
================================================================================
NE 591 Project #04
Author: Kirill Shumilov
Date: 03/21/2025
--------------------------------------------------------------------------------
Solving Source Iteration Equations with Parallel Point-Jacobi
================================================================================
                                     Inputs                                     
#Processes..............................: 4
Space Dimensions, a x b.................: 1.000000e+00 x 1.000000e+00
Non-Zero Grid Points, M x N.............: 8 x 8
Diffusion Coefficient, D................: 1
Macroscopic Removal Cross Section, Sa...: 2
Source, q...............................: <8 x 8, e>
[[ 0.000000e+00  1.000000e+00  2.000000e+00  3.000000e+00  4.000000e+00  5.000000e+00  6.000000e+00  7.000000e+00] 
 [ 8.000000e+00  9.000000e+00  1.000000e+01  1.100000e+01  1.200000e+01  1.300000e+01  1.400000e+01  1.500000e+01] 
 [ 1.600000e+01  1.700000e+01  1.800000e+01  1.900000e+01  2.000000e+01  2.100000e+01  2.200000e+01  2.300000e+01] 
 [ 2.400000e+01  2.500000e+01  2.600000e+01  2.700000e+01  2.800000e+01  2.900000e+01  3.000000e+01  3.100000e+01] 
 [ 3.200000e+01  3.300000e+01  3.400000e+01  3.500000e+01  3.600000e+01  3.700000e+01  3.800000e+01  3.900000e+01] 
 [ 4.000000e+01  4.100000e+01  4.200000e+01  4.300000e+01  4.400000e+01  4.500000e+01  4.600000e+01  4.700000e+01] 
 [ 4.800000e+01  4.900000e+01  5.000000e+01  5.100000e+01  5.200000e+01  5.300000e+01  5.400000e+01  5.500000e+01] 
 [ 5.600000e+01  5.700000e+01  5.800000e+01  5.900000e+01  6.000000e+01  6.100000e+01  6.200000e+01  6.300000e+01]]
Selected Method: Point Jacobi
Fixed-Point Iteration:
        Maximum Number of Iterations............: 1000
        Tolerance...............................: 1.000000e-07
================================================================================
Rank 0, SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256021e-05
Rank 2, SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256021e-05
Rank 3, SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256021e-05
Rank 1, SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256022e-05
................................................................................
Rank 0: SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256022e-05
Execution time: 00.025799000 seconds.
================================================================================
SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256022e-05
  i     j        flux     
    1     1  1.73632506e-01
    1     2  3.17774834e-01
    1     3  4.21905623e-01
    1     4  4.83681772e-01
    1     5  5.01359395e-01
    1     6  4.70978688e-01
    1     7  3.85237983e-01
    1     8  2.33120923e-01
    2     1  3.81042470e-01
    2     2  6.71061934e-01
    2     3  8.71892100e-01
    2     4  9.86367962e-01
    2     5  1.01377382e+00
    2     6  9.47218235e-01
    2     7  7.72290406e-01
    2     8  4.66582086e-01
    3     1  5.90118576e-01
    3     2  1.01899686e+00
    3     3  1.30630457e+00
    3     4  1.46467678e+00
    3     5  1.49703330e+00
    3     6  1.39472459e+00
    3     7  1.13635292e+00
    3     8  6.87252486e-01
    4     1  7.77475092e-01
    4     2  1.32378651e+00
    4     3  1.67968516e+00
    4     4  1.87059865e+00
    4     5  1.90500867e+00
    4     6  1.77347265e+00
    4     7  1.44759766e+00
    4     8  8.79093664e-01
    5     1  9.18896076e-01
    5     2  1.54303335e+00
    5     3  1.93853737e+00
    5     4  2.14587879e+00
    5     5  2.18028881e+00
    5     6  2.03232487e+00
    5     7  1.66684450e+00
    5     8  1.02051465e+00
    6     1  9.82703101e-01
    6     2  1.62160593e+00
    6     3  2.01366467e+00
    6     4  2.21497672e+00
    6     5  2.24733325e+00
    6     6  2.10208468e+00
    6     7  1.73896200e+00
    6     8  1.07983701e+00
    7     1  9.20747656e-01
    7     2  1.48088971e+00
    7     3  1.81074062e+00
    7     4  1.97685719e+00
    7     5  2.00426304e+00
    7     6  1.88606676e+00
    7     7  1.58211819e+00
    7     8  1.00628727e+00
    8     1  6.49539840e-01
    8     2  1.00209176e+00
    8     3  1.19897690e+00
    8     4  1.29663035e+00
    8     5  1.31430797e+00
    8     6  1.24804996e+00
    8     7  1.06955491e+00
    8     8  7.09028257e-01
[kshumil@login02 shumilov_project04]$ ./shumilov_project04 examples/s8_pj.inp 1> examples/s8_pj.out
[kshumil@login02 shumilov_project04]$ cat examples/s8_pj.out
================================================================================
NE 591 Project #04
Author: Kirill Shumilov
Date: 03/21/2025
--------------------------------------------------------------------------------
Solving Source Iteration Equations with Parallel Point-Jacobi
================================================================================
                                     Inputs                                     
#Processes..............................: 4
Space Dimensions, a x b.................: 1.000000e+00 x 1.000000e+00
Non-Zero Grid Points, M x N.............: 8 x 8
Diffusion Coefficient, D................: 1
Macroscopic Removal Cross Section, Sa...: 2
Source, q...............................: <8 x 8, e>
[[ 0.000000e+00  1.000000e+00  2.000000e+00  3.000000e+00  4.000000e+00  5.000000e+00  6.000000e+00  7.000000e+00] 
 [ 8.000000e+00  9.000000e+00  1.000000e+01  1.100000e+01  1.200000e+01  1.300000e+01  1.400000e+01  1.500000e+01] 
 [ 1.600000e+01  1.700000e+01  1.800000e+01  1.900000e+01  2.000000e+01  2.100000e+01  2.200000e+01  2.300000e+01] 
 [ 2.400000e+01  2.500000e+01  2.600000e+01  2.700000e+01  2.800000e+01  2.900000e+01  3.000000e+01  3.100000e+01] 
 [ 3.200000e+01  3.300000e+01  3.400000e+01  3.500000e+01  3.600000e+01  3.700000e+01  3.800000e+01  3.900000e+01] 
 [ 4.000000e+01  4.100000e+01  4.200000e+01  4.300000e+01  4.400000e+01  4.500000e+01  4.600000e+01  4.700000e+01] 
 [ 4.800000e+01  4.900000e+01  5.000000e+01  5.100000e+01  5.200000e+01  5.300000e+01  5.400000e+01  5.500000e+01] 
 [ 5.600000e+01  5.700000e+01  5.800000e+01  5.900000e+01  6.000000e+01  6.100000e+01  6.200000e+01  6.300000e+01]]
Selected Method: Point Jacobi
Fixed-Point Iteration:
        Maximum Number of Iterations............: 1000
        Tolerance...............................: 1.000000e-07
================================================================================
Rank 0, SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256021e-05
Rank 2, SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256021e-05
Rank 3, SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256021e-05
Rank 1, SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256022e-05
................................................................................
Rank 0: SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256022e-05
Execution time: 00.025799000 seconds.
================================================================================
SUCCESS at #205 with error: 9.46881542e-08, max|res|: 3.98256022e-05
  i     j        flux     
    1     1  1.73632506e-01
    1     2  3.17774834e-01
    1     3  4.21905623e-01
    1     4  4.83681772e-01
    1     5  5.01359395e-01
    1     6  4.70978688e-01
    1     7  3.85237983e-01
    1     8  2.33120923e-01
    2     1  3.81042470e-01
    2     2  6.71061934e-01
    2     3  8.71892100e-01
    2     4  9.86367962e-01
    2     5  1.01377382e+00
    2     6  9.47218235e-01
    2     7  7.72290406e-01
    2     8  4.66582086e-01
    3     1  5.90118576e-01
    3     2  1.01899686e+00
    3     3  1.30630457e+00
    3     4  1.46467678e+00
    3     5  1.49703330e+00
    3     6  1.39472459e+00
    3     7  1.13635292e+00
    3     8  6.87252486e-01
    4     1  7.77475092e-01
    4     2  1.32378651e+00
    4     3  1.67968516e+00
    4     4  1.87059865e+00
    4     5  1.90500867e+00
    4     6  1.77347265e+00
    4     7  1.44759766e+00
    4     8  8.79093664e-01
    5     1  9.18896076e-01
    5     2  1.54303335e+00
    5     3  1.93853737e+00
    5     4  2.14587879e+00
    5     5  2.18028881e+00
    5     6  2.03232487e+00
    5     7  1.66684450e+00
    5     8  1.02051465e+00
    6     1  9.82703101e-01
    6     2  1.62160593e+00
    6     3  2.01366467e+00
    6     4  2.21497672e+00
    6     5  2.24733325e+00
    6     6  2.10208468e+00
    6     7  1.73896200e+00
    6     8  1.07983701e+00
    7     1  9.20747656e-01
    7     2  1.48088971e+00
    7     3  1.81074062e+00
    7     4  1.97685719e+00
    7     5  2.00426304e+00
    7     6  1.88606676e+00
    7     7  1.58211819e+00
    7     8  1.00628727e+00
    8     1  6.49539840e-01
    8     2  1.00209176e+00
    8     3  1.19897690e+00
    8     4  1.29663035e+00
    8     5  1.31430797e+00
    8     6  1.24804996e+00
    8     7  1.06955491e+00
    8     8  7.09028257e-01
```

### Running MPI Parallel with larger system
#### On Login node (Not Recommended)
```
[kshumil@login02 shumilov_project04]$ mpirun -n 4./shumilov_project04 examples/s12_pj.inp
================================================================================
NE 591 Project #04
Author: Kirill Shumilov
Date: 03/21/2025
--------------------------------------------------------------------------------
Solving Source Iteration Equations with Parallel Point-Jacobi
================================================================================
                                     Inputs                                     
#Processes..............................: 9
Space Dimensions, a x b.................: 1.000000e+00 x 1.000000e+00
Non-Zero Grid Points, M x N.............: 12 x 12
Diffusion Coefficient, D................: 1
Macroscopic Removal Cross Section, Sa...: 2
Source, q...............................: <12 x 12, e>
Selected Method: Point Jacobi
Fixed-Point Iteration:
        Maximum Number of Iterations............: 10000
        Tolerance...............................: 1.000000e-08
================================================================================
Rank 0, SUCCESS at #477 with error: 9.88752850e-09, max|res|: 1.47855205e-05
Rank 6, SUCCESS at #477 with error: 9.88752850e-09, max|res|: 1.47855213e-05
Rank 4, SUCCESS at #477 with error: 9.88752850e-09, max|res|: 2.15128419e-05
Rank 7, SUCCESS at #477 with error: 9.88752850e-09, max|res|: 1.78347573e-05
Rank 5, SUCCESS at #477 with error: 9.88752850e-09, max|res|: 1.78347574e-05
Rank 1, SUCCESS at #477 with error: 9.88752850e-09, max|res|: 1.78347573e-05
Rank 3, SUCCESS at #477 with error: 9.88752850e-09, max|res|: 1.78347585e-05
Rank 2, SUCCESS at #477 with error: 9.88752850e-09, max|res|: 1.47855206e-05
Rank 8, SUCCESS at #477 with error: 9.88752850e-09, max|res|: 1.47855208e-05
................................................................................
Rank 0: SUCCESS at #477 with error: 9.88752850e-09, max|res|: 2.15128419e-05
Execution time: 00.062285000 seconds.
================================================================================
[kshumil@login02 shumilov_project04]$ cat Flux
SUCCESS at #477 with error: 9.88752850e-09, max|res|: 2.15128419e-05
  i     j        flux     
    1     1  2.12145550e-01
    1     2  3.99074444e-01
    1     3  5.52203419e-01
    1     4  6.69947514e-01
    1     5  7.52690824e-01
    1     6  8.00911377e-01
    1     7  8.14378472e-01
    1     8  7.91771959e-01
    1     9  7.30497017e-01
    1    10  6.26608605e-01
    1    11  4.74812073e-01
    1    12  2.68526289e-01
    2     1  4.52018361e-01
    2     2  8.30754436e-01
    2     3  1.13449237e+00
    2     4  1.36507273e+00
    2     5  1.52514338e+00
    2     6  1.61646868e+00
    2     7  1.63896524e+00
    2     8  1.59016234e+00
    2     9  1.46491519e+00
    2    10  1.25528640e+00
    2    11  9.50560895e-01
    2    12  5.37382158e-01
    3     1  6.99516886e-01
    3     2  1.27034094e+00
    3     3  1.72052464e+00
    3     4  2.05810503e+00
    3     5  2.28971581e+00
    3     6  2.41939289e+00
    3     7  2.44773869e+00
    3     8  2.37138948e+00
    3     9  2.18270812e+00
    3    10  1.86965605e+00
    3    11  1.41583470e+00
    3    12  8.00706339e-01
    4     1  9.41974740e-01
    4     2  1.69767244e+00
    4     3  2.28567537e+00
    4     4  2.72169996e+00
    4     5  3.01763877e+00
    4     6  3.18068272e+00
    4     7  3.21265975e+00
    4     8  3.10958069e+00
    4     9  2.86135358e+00
    4    10  2.45165488e+00
    4    11  1.85798757e+00
    4    12  1.05198374e+00
    5     1  1.16883953e+00
    5     2  2.09385467e+00
    5     3  2.80500184e+00
    5     4  3.32682099e+00
    5     5  3.67748201e+00
    5     6  3.86807723e+00
    5     7  3.90213593e+00
    5     8  3.77528194e+00
    5     9  3.47497786e+00
    5    10  2.98036388e+00
    5    11  2.26227569e+00
    5    12  1.28358407e+00
    6     1  1.36933750e+00
    6     2  2.43874345e+00
    6     3  3.25099370e+00
    6     4  3.84069577e+00
    6     5  4.23321934e+00
    6     6  4.44417496e+00
    6     7  4.47917742e+00
    6     8  4.33366752e+00
    6     9  3.99267518e+00
    6    10  3.43053964e+00
    6    11  2.61074451e+00
    6    12  1.48615480e+00
    7     1  1.53094264e+00
    7     2  2.70870211e+00
    7     3  3.59114321e+00
    7     4  4.22442013e+00
    7     5  4.64192379e+00
    7     6  4.86420440e+00
    7     7  4.89920686e+00
    7     8  4.74237197e+00
    7     9  4.37639953e+00
    7    10  3.77068915e+00
    7    11  2.88070317e+00
    7    12  1.64775994e+00
    8     1  1.63781315e+00
    8     2  2.87408219e+00
    8     3  3.78508591e+00
    8     4  4.43012400e+00
    8     5  4.85108126e+00
    8     6  5.07345538e+00
    8     7  5.10751408e+00
    8     8  4.94888120e+00
    8     9  4.57828087e+00
    8    10  3.96044795e+00
    8    11  3.04250321e+00
    8    12  1.75255769e+00
    9     1  1.66856877e+00
    9     2  2.89578189e+00
    9     3  3.78091247e+00
    9     4  4.39754342e+00
    9     5  4.79552117e+00
    9     6  5.00443556e+00
    9     7  5.03641259e+00
    9     8  4.88746309e+00
    9     9  4.53719704e+00
    9    10  3.94689199e+00
    9    11  3.05609702e+00
    9    12  1.77857777e+00
   10     1  1.59237912e+00
   10     2  2.71986928e+00
   10     3  3.51010161e+00
   10     4  4.04985923e+00
   10     5  4.39406030e+00
   10     6  4.57394416e+00
   10     7  4.60228996e+00
   10     8  4.47573398e+00
   10     9  4.17446233e+00
   10    10  3.65923302e+00
   10    11  2.86536305e+00
   10    12  1.69356857e+00
   11     1  1.36086991e+00
   11     2  2.26843193e+00
   11     3  2.88041758e+00
   11     4  3.28885428e+00
   11     5  3.54619554e+00
   11     6  3.68048138e+00
   11     7  3.70297794e+00
   11     8  3.61121450e+00
   11     9  3.38869673e+00
   11    10  3.00121161e+00
   11    11  2.38823839e+00
   11    12  1.44623371e+00
   12     1  8.88714416e-01
   12     2  1.42344000e+00
   12     3  1.76647685e+00
   12     4  1.99005550e+00
   12     5  2.12962526e+00
   12     6  2.20271897e+00
   12     7  2.21618607e+00
   12     8  2.16870640e+00
   12     9  2.05060500e+00
   12    10  1.84088204e+00
   12    11  1.49917763e+00
   12    12  9.45095155e-01
```
#### On Compute node (Recommended)
```bash
[kshumil@login02 shumilov_project04]$ bsub < submit_project04.sh
```